<html>
  <head>
    <meta charset="utf-8">
    <title>Solid App</title>
  </head>
  <body>
    <div id="loginBanner"></div>
    <div id="ui" style="display:none">
      (UI goes here...)
    </div>
  </body>
  <script src="./solid-auth-fetcher.bundle.js"></script>
  <script>
    window.onload = async () => {
      const TEST_URL = 'https://michielbdejong.solidcommunity.net/private/';
      document.write(`Testing access to ${TEST_URL} using solid-auth-fetcher: `);
      const authFetcher = await solidAuthFetcher.customAuthFetcher();
      const result = await solidAuthFetcher.fetch(TEST_URL);
      document.write(`${result.status}<br>`);
      if (result.status === 401) {
        document.write('Logging in!<br>');
        const session = await authFetcher.login({
          oidcIssuer: new URL(TEST_URL).origin,
          redirect: location.href
        });
        // FIXME: avoid this hard-coded timeout
        // Without this you end up at http://localhost:5000/undefined
        await new Promise(resolve => setTimeout(resolve, 5000));
        window.location = session.neededAction.redirectUrl;
      }
    }
  </script>
</html>
